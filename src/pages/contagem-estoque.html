<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Comercial São José | Contagem Manual de Estoque</title>
    <link rel="stylesheet" href="../styles/common.css" />
    <link rel="stylesheet" href="../styles/contagem-estoque.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  </head>
  <body>
    <div class="sidebar">
      <h2><a href="./index.html">São José</a></h2>
      <div class="user-info">
        <img src="../assets/user-avatar.png" alt="Avatar do usuário" class="user-avatar">
        <span class="user-name">Nome do Usuário</span>
      </div>
      <ul>
        <li><a href="cadastro-produtos.html"><i class="fas fa-box"></i> Cadastro de Produtos</a></li>
        <li><a href="vendas.html"><i class="fas fa-chart-line"></i> Vendas</a></li>
        <li><a href="realizar-vendas.html"><i class="fas fa-cash-register"></i> Realizar Vendas</a></li>
        <li><a href="entrada-saida.html"><i class="fas fa-exchange-alt"></i> Entrada e Saída</a></li>
        <li><a href="controle-estoque.html"><i class="fas fa-warehouse"></i> Controle de Estoque</a></li>
        <li class="active"><a href="contagem-estoque.html"><i class="fas fa-clipboard-list"></i> Contagem Manual</a></li>
        <li><a href="imprimir-estoque.html"><i class="fas fa-print"></i> Imprimir Estoque</a></li>
      </ul>
    </div>

    <main class="main-content">
      <h1>Contagem Manual de Estoque</h1>
      <form id="contagemForm">
        <div class="produto">
          <label for="produto_1">Produto A:</label>
          <input type="number" id="produto_1" name="1" required min="0">
        </div>
        <div class="produto">
          <label for="produto_2">Produto B:</label>
          <input type="number" id="produto_2" name="2" required min="0">
        </div>
        <div class="produto">
          <label for="produto_3">Produto C:</label>
          <input type="number" id="produto_3" name="3" required min="0">
        </div>
        <button type="submit">Calcular Diferenças</button>
      </form>

      <div id="resultado" style="display: none;">
        <h2>Resultado da Contagem</h2>
        <table>
          <tr>
            <th>Produto</th>
            <th>Quantidade no Sistema</th>
            <th>Quantidade Contada</th>
            <th>Diferença</th>
            <th>Valor Perdido (R$)</th>
          </tr>
          <tbody id="resultadoTabela"></tbody>
        </table>
        <p>Total perdido: R$ <span id="totalPerdido"></span></p>
      </div>
    </main>

    <footer>Direitos Reservados a TY-BYTE em nome de Raphael Câmara</footer>

    <script src="../js/common.js"></script>
    <script src="../js/contagem-estoque.js"></script>
    <script>
      document.getElementById('contagemForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        const resultados = [];
        let totalPerdido = 0;

        for (let [id, quantidade] of formData.entries()) {
          const produto = produtos.find(p => p.id === parseInt(id));
          if (produto) {
            const diferenca = parseInt(quantidade) - produto.quantidade;
            const valorPerdido = diferenca < 0 ? Math.abs(diferenca) * produto.preco : 0;
            totalPerdido += valorPerdido;
            resultados.push({
              nome: produto.nome,
              quantidadeSistema: produto.quantidade,
              quantidadeContada: parseInt(quantidade),
              diferenca: diferenca,
              valorPerdido: valorPerdido.toFixed(2)
            });
          }
        }

        const tbody = document.getElementById('resultadoTabela');
        tbody.innerHTML = '';
        resultados.forEach(r => {
          tbody.innerHTML += `
            <tr>
              <td>${r.nome}</td>
              <td>${r.quantidadeSistema}</td>
              <td>${r.quantidadeContada}</td>
              <td>${r.diferenca}</td>
              <td>R$ ${r.valorPerdido}</td>
            </tr>
          `;
        });

        document.getElementById('totalPerdido').textContent = totalPerdido.toFixed(2);
        document.getElementById('resultado').style.display = 'block';
      });

      // Simular dados de produtos (substitua isso pelos dados reais do seu backend)
      const produtos = [
        { id: 1, nome: 'Produto A', quantidade: 100, preco: 10 },
        { id: 2, nome: 'Produto B', quantidade: 50, preco: 20 },
        { id: 3, nome: 'Produto C', quantidade: 75, preco: 15 }
      ];
    </script>
  </body>
</html>